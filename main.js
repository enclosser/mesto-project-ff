(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o),t.addEventListener("click",n)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),t.removeEventListener("click",n)}function n(t){t.target.closest(".popup__content")||(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}function o(t){"Escape"===t.key&&(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-21",headers:{authorization:"ba726ca4-babe-4c60-b803-4ec06cee7921","Content-Type":"application/json"}};function a(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function l(t,e){return fetch("".concat(u.baseUrl).concat(t),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({headers:u.headers},e)).then(a)}var p=l("/users/me",{method:"GET"}),s=l("/cards",{method:"GET"}),d=function(t){return l("/cards/".concat(t),{method:"DELETE"})},f=function(t){return l("/cards/likes/".concat(t),{method:"PUT"})},_=function(t){return l("/cards/likes/".concat(t),{method:"DELETE"})},m=document.querySelector("#card-template").content,y=document.querySelector(".delete__popup"),v=y.querySelector(".popup__button");function b(n,o){var r=n.target.closest(".card");t(y),v.addEventListener("click",(function(t){v.textContent="Удаление...",d(o._id).then((function(t){r.remove(),e(y)})).catch((function(t){console.log(t)})).finally((function(t){v.textContent="Да"}))}))}function S(t,e,n){t.target.classList.contains("card__like-button_is-active")?_(e.informationCard._id).then((function(e){n.textContent=""+e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)})):f(e.informationCard._id).then((function(e){n.textContent=""+e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)}))}var g=function(t,e,n,o){var r=t.querySelector(".input_".concat(e.name,"-error"));e.classList.add(o),r.textContent=n},h=function(t,e,n){t.querySelector(".input_".concat(e.name,"-error")).textContent="",e.classList.remove(n)};function q(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?h(t,e,n):g(t,e,e.validationMessage,n)}function C(t,e,n){E(e,n),e.forEach((function(o){h(t,o),o.removeEventListener("input",(function(r){q(t,o),E(e,n)}))}))}var E=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__button_disabled";!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(""+n),e.removeAttribute("disabled","")):(e.setAttribute("disabled",""),e.classList.add(""+n))},k=/http.*(jpeg|jpg|gif|png)/gi,L=document.querySelector(".places__list"),O=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),x=document.querySelector(".profile__edit-button"),P=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit"),D=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),M=document.querySelector(".popup_type_edit_avatar"),U=document.querySelectorAll(".popup__close"),F=T.querySelector(".popup__image"),I=T.querySelector(".popup__caption"),N=A.querySelector(".popup__form[name='edit-profile']"),B=D.querySelector(".popup__form[name='new-place']"),J=M.querySelector(".popup__form[name='edit-avatar']"),G=Array.from(document.querySelectorAll(".popup__form")),H=Array.from(N.querySelectorAll(".popup__input")),V=Array.from(B.querySelectorAll(".popup__input")),z=Array.from(J.querySelectorAll(".popup__input")),K=N.querySelector(".popup__input_type_name"),Q=N.querySelector(".popup__input_type_description"),R=B.querySelector(".popup__input_type_card-name"),W=B.querySelector(".popup__input_type_url"),X=N.querySelector(".popup__button"),Y=B.querySelector(".popup__button"),Z=J.querySelector(".popup__button"),$=[p,s];function tt(t){return function(t,e,n,o){var r=t.informationCard,i=m.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__like-button"),u=i.querySelector(".card__image"),a=i.querySelector(".like__counter"),l=""+r.likes.length;a.textContent=l,u.src=r.link,u.alt=r.name,i.querySelector(".card__title").textContent=r.name;var p=i.querySelector(".card__delete-button");return r.owner._id===t.informationMe._id?p.addEventListener("click",(function(t){e(t,r)})):p.remove(),r.likes.forEach((function(e){e._id===t.informationMe._id&&c.classList.add("card__like-button_is-active")})),c.addEventListener("click",(function(e){n(e,t,a)})),u.addEventListener("click",(function(t){o(t)})),i}(t,b,S,et)}function et(e){F.src=e.target.src,F.alt=e.target.alt,I.textContent=e.target.alt,t(T)}x.addEventListener("click",(function(e){K.value=O.textContent,Q.value=j.textContent,t(A),C(N,H,X)})),P.addEventListener("click",(function(e){B.reset(),C(B,V,Y),t(D)})),w.addEventListener("click",(function(e){C(J,z,Z),t(M)})),U.forEach((function(t){t.addEventListener("click",(function(t){e(t.target.closest(".popup"))}))})),N.addEventListener("submit",(function(t){!function(t,n){var o;t.preventDefault(),X.textContent="Сохранение...",(o={name:K.value,job:Q.value},l("/users/me",{method:"PATCH",body:JSON.stringify({name:o.name,about:o.job})})).then((function(t){O.textContent=t.name,j.textContent=t.about,e(A)})).catch((function(t){console.log(t)})).finally((function(t){X.textContent="Сохранить"}))}(t)})),B.addEventListener("submit",(function(t){!function(t,e,n){var o;Y.textContent="Сохранение...",t.preventDefault(),(o={dataCard:{name:R.value,link:W.value,likes:[]}},l("/cards",{method:"POST",body:JSON.stringify({link:o.dataCard.link,name:o.dataCard.name})})).then((function(t){var n;n=tt({informationCard:t,informationMe:dataUserInfo}),L.prepend(n),e(D)})).catch((function(t){console.log(t)})).finally((function(t){Y.textContent="Создать"}))}(t,e)})),J.addEventListener("submit",(function(t){!function(t,n){t.preventDefault(),Z.textContent="Сохранение...";var o=n.querySelector(".popup__input_type_url");(function(t){return l("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:t})})})(o.value).then((function(t){w.setAttribute("style","background-image: url(".concat(t.avatar,")")),o.value="",e(M)})).catch((function(t){console.log(t)})).finally((function(t){Z.textContent="Сохранить"}))}(t,J)})),G.forEach((function(t){var e;e={formSelector:t,inputListFormProfile:Array.from(t.querySelectorAll(".popup__input")),buttonSubmit:t.querySelector(".popup__button"),inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},E(e.inputListFormProfile,e.buttonSubmit,e.inactiveButtonClass),e.inputListFormProfile.forEach((function(t){t.addEventListener("input",(function(n){q(e.formSelector,t,e.inputErrorClass),E(e.inputListFormProfile,e.buttonSubmit,e.inactiveButtonClass)}))}))})),Promise.all($).then((function(t){window.dataUserInfo=t[0],function(t){O.textContent=t.name,j.textContent=t.about,w.setAttribute("style","background-image: url(".concat(t.avatar,")"))}(dataUserInfo),function(t){t.forEach((function(t){if(k.test(t.link)){var e=tt({informationCard:t,informationMe:dataUserInfo});L.append(e)}}))}(t[1])})).catch((function(t){console.log(t)}))})();
//# sourceMappingURL=main.js.map